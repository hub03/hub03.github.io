<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse de données commerciales</title>
    
    <style>
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        h1 { color: #333; }
        .container { width: 80%; max-width: 900px; margin-top: 20px; }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Tableau de bord commercial</h1>
    <p>Sélectionnez votre fichier Excel de résultats pour voir les graphiques.</p>

    <input type="file" id="fileInput" accept=".xlsx">
    
    <div class="container">
        <canvas id="myChart"></canvas>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', handleFile, false);

        async function handleFile(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, { type: 'array' });

                // Accéder à la première feuille de calcul
                const sheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[sheetName];
                
                // Convertir les données de la feuille en format JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                
                // Appeler la fonction pour dessiner le graphique
                displayChart(jsonData);
            };
            reader.readAsArrayBuffer(file);
        }

        function displayChart(data) {
            // Supposons que la première ligne contient les en-têtes (par exemple, "Produit", "Ventes")
            const headers = data[0];
            const rows = data.slice(1);

            // Adaptez cette partie selon les colonnes de votre fichier Excel
            // Exemple : supposons que la colonne "Produit" est à l'index 0 et "Ventes" à l'index 1
            const labels = rows.map(row => row[0]); // Les noms des produits
            const values = rows.map(row => row[1]); // Les chiffres de vente

            const ctx = document.getElementById('myChart').getContext('2d');
            
            if (window.myChartInstance) {
                window.myChartInstance.destroy(); // Détruit le graphique précédent si l'utilisateur charge un nouveau fichier
            }

            window.myChartInstance = new Chart(ctx, {
                type: 'bar', // ou 'line', 'pie', etc. pour d'autres types de graphiques
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Résultats des ventes',
                        data: values,
                        backgroundColor: 'rgba(54, 162, 235, 0.5)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }
    </script>
</body>
</html>
